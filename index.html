<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donasi - Bagus Donasi</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="relative w-full h-screen flex flex-col items-center justify-center text-white overflow-hidden">

    <!-- Background Video -->
    <video autoplay muted loop class="absolute top-0 left-0 w-full h-full object-cover">
        <source src="https://files.catbox.moe/4u8827.mp4" type="video/mp4">
        Browser Anda tidak mendukung video latar belakang.
    </video>

    <!-- Overlay Gelap untuk Kontras -->
    <div class="absolute inset-0 bg-black/40"></div>

    <!-- Header -->
    <header class="absolute top-0 w-full text-center py-4 text-white text-3xl font-bold z-10">
        <span id="typewriter"></span>
    </header>

    <!-- Main Content -->
    <main class="relative z-10 p-6 w-full max-w-lg bg-white/20 backdrop-blur-md rounded-xl shadow-lg text-center">
        <h2 class="text-2xl font-semibold text-white mb-4">Form Donasi</h2>

        <!-- Input Nominal -->
        <label for="nominal" class="block text-white text-lg font-medium mb-2">Nominal Donasi:</label>
        <input type="number" id="nominal" class="w-full p-3 bg-white/40 text-black rounded-md border border-white/50 outline-none focus:ring-2 focus:ring-blue-500 mb-4" placeholder="Masukkan nominal" min="1000">

        <!-- Tombol Buat QRIS -->
        <button id="generateQRIS" class="w-full p-3 rounded-lg text-white font-semibold bg-gray-500 cursor-not-allowed transition-all" disabled>
            Buat QRIS
        </button>

        <!-- Tempat QRIS -->
        <div id="qrisContainer" class="mt-6 hidden">
            <img id="qrisImage" src="" alt="QRIS" class="mx-auto w-48 h-48">
            <div id="countdown" class="mt-3 text-green-300 font-semibold">Silahkan scan QRIS sebelum waktu habis.</div>
        </div>
    </main>

    <script>
        // Efek Ketik & Hapus
        const textElement = document.getElementById("typewriter");
        const text = "Bagus Donasi";
        let index = 0;
        let isDeleting = false;

        function typeEffect() {
            if (!isDeleting && index < text.length) {
                textElement.innerText = text.substring(0, index + 1);
                index++;
                setTimeout(typeEffect, 150);
            } else if (isDeleting && index > 0) {
                textElement.innerText = text.substring(0, index - 1);
                index--;
                setTimeout(typeEffect, 100);
            } else {
                isDeleting = !isDeleting;
                setTimeout(typeEffect, 1000);
            }
        }
        typeEffect();

        // Validasi Input & Aktivasi Tombol
        document.getElementById("nominal").addEventListener("input", function () {
            const nominal = this.value;
            const btnQRIS = document.getElementById("generateQRIS");

            if (nominal >= 1000) {
                btnQRIS.classList.remove("bg-gray-500", "cursor-not-allowed");
                btnQRIS.classList.add("bg-blue-600", "hover:bg-blue-700");
                btnQRIS.disabled = false;
            } else {
                btnQRIS.classList.remove("bg-blue-600", "hover:bg-blue-700");
                btnQRIS.classList.add("bg-gray-500", "cursor-not-allowed");
                btnQRIS.disabled = true;
            }
        });

        // Generate QRIS
        document.getElementById("generateQRIS").addEventListener("click", async function () {
            const nominal = document.getElementById("nominal").value;
            const url = `https://rafaelxd.tech/api/orkut/createpayment?apikey=rafael&amount=${nominal}&codeqr=00020101021126670016COM.NOBUBANK.WWW01189360050300000879140214057125036591790303UMI51440014ID.CO.QRIS.WWW0215ID20232646203860303UMI5204481253033605802ID5918GOODFM21%20OK11756396008MINAHASA61059537162070703A016304D7A6`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.status) {
                    document.getElementById("qrisImage").src = data.result.qrImageUrl;
                    document.getElementById("qrisContainer").classList.remove("hidden");

                    // Timer mundur 5 menit
                    let timeLeft = 5 * 60;
                    const countdownElement = document.getElementById("countdown");
                    const interval = setInterval(() => {
                        const minutes = Math.floor(timeLeft / 60);
                        const seconds = timeLeft % 60;
                        countdownElement.innerText = `Silahkan scan QRIS sebelum waktu habis. (${minutes}:${seconds < 10 ? '0' : ''}${seconds})`;
                        
                        timeLeft--;

                        if (timeLeft < 0) {
                            clearInterval(interval);
                            countdownElement.innerText = "Waktu habis :(";
                            countdownElement.classList.remove("text-green-300");
                            countdownElement.classList.add("text-red-400");

                            // Hapus QRIS
                            document.getElementById("qrisImage").remove();
                        }
                    }, 1000);
                } else {
                    alert("Gagal membuat QRIS, coba lagi.");
                }
            } catch (error) {
                console.error("Error fetching QRIS:", error);
                alert("Terjadi kesalahan, coba lagi.");
            }
        });
    </script>

</body>
</html>
