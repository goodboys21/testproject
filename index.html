<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donasi - Bagus Donasi</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-50 text-gray-800">

    <!-- Header -->
    <header class="bg-blue-600 text-white shadow p-4">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-3xl font-bold">
                <span id="typewriter"></span>
            </h1>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto mt-6 p-4">
        <section class="bg-white p-6 rounded shadow-lg max-w-lg mx-auto">
            <h2 class="text-2xl font-semibold text-blue-700 mb-4 text-center">Form Donasi</h2>
            
            <!-- Input Nominal -->
            <label for="nominal" class="block text-gray-700 font-medium mb-2">Nominal Donasi:</label>
            <input type="number" id="nominal" class="w-full p-2 border rounded mb-4" placeholder="Masukkan nominal" min="1000">

            <!-- Tombol Buat QRIS -->
            <button id="generateQRIS" class="bg-gray-400 text-white px-4 py-2 rounded w-full cursor-not-allowed" disabled>
                Buat QRIS
            </button>

            <!-- Tempat QRIS -->
            <div id="qrisContainer" class="mt-4 hidden text-center">
                <img id="qrisImage" src="" alt="QRIS" class="mx-auto w-48 h-48">
                <button id="downloadQRIS" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded inline-block hidden">
                    Download QRIS
                </button>
            </div>
        </section>
    </main>

    <script>
        // Efek Ketik & Hapus
        const textElement = document.getElementById("typewriter");
        const text = "Bagus Donasi";
        let index = 0;
        let isDeleting = false;

        function typeEffect() {
            if (!isDeleting && index < text.length) {
                textElement.innerText = text.substring(0, index + 1);
                index++;
                setTimeout(typeEffect, 150); // Kecepatan ketik
            } else if (isDeleting && index > 0) {
                textElement.innerText = text.substring(0, index - 1);
                index--;
                setTimeout(typeEffect, 100); // Kecepatan hapus
            } else {
                isDeleting = !isDeleting;
                setTimeout(typeEffect, 1000); // Tunggu sebelum ulangi
            }
        }
        typeEffect();

        // Fungsi Validasi Nominal & QRIS
        document.getElementById("nominal").addEventListener("input", function () {
            const nominal = this.value;
            const btnQRIS = document.getElementById("generateQRIS");

            if (nominal >= 1000) {
                btnQRIS.classList.remove("bg-gray-400", "cursor-not-allowed");
                btnQRIS.classList.add("bg-blue-500", "hover:bg-blue-600");
                btnQRIS.disabled = false;
            } else {
                btnQRIS.classList.remove("bg-blue-500", "hover:bg-blue-600");
                btnQRIS.classList.add("bg-gray-400", "cursor-not-allowed");
                btnQRIS.disabled = true;
            }
        });

        document.getElementById("generateQRIS").addEventListener("click", async function () {
            const nominal = document.getElementById("nominal").value;
            const url = `https://rafaelxd.tech/api/orkut/createpayment?apikey=rafael&amount=${nominal}&codeqr=00020101021126670016COM.NOBUBANK.WWW01189360050300000879140214057125036591790303UMI51440014ID.CO.QRIS.WWW0215ID20232646203860303UMI5204481253033605802ID5918GOODFM21%20OK11756396008MINAHASA61059537162070703A016304D7A6`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.status) {
                    document.getElementById("qrisImage").src = data.result.qrImageUrl;
                    document.getElementById("qrisContainer").classList.remove("hidden");
                    document.getElementById("downloadQRIS").classList.remove("hidden");

                    // Event listener buat download QRIS
                    document.getElementById("downloadQRIS").addEventListener("click", async function () {
                        const qrImage = await fetch(data.result.qrImageUrl);
                        const qrBlob = await qrImage.blob();
                        const qrURL = URL.createObjectURL(qrBlob);

                        const a = document.createElement("a");
                        a.href = qrURL;
                        a.download = "qris.png";
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(qrURL);
                    });
                } else {
                    alert("Gagal membuat QRIS, coba lagi.");
                }
            } catch (error) {
                console.error("Error fetching QRIS:", error);
                alert("Terjadi kesalahan, coba lagi.");
            }
        });
    </script>

</body>
</html>
